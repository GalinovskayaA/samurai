(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[4],{306:function(e,t,s){e.exports={scroll:"chat_scroll__3PyJQ",textarea:"chat_textarea__1hIq3"}},307:function(e,t,s){e.exports={dialogItems:"Dialogs_dialogItems__5F9JH",messages:"Dialogs_messages__JCIKe",users:"Dialogs_users__15ZW7",dialogScrollbar:"Dialogs_dialogScrollbar__LTJ-G"}},308:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var n=s(24),c=s(0),a=s(1),o=s.n(a),i=s(306),r=s.n(i),l=s(309),j=s.n(l),u=function(e){var t=e.chosenEmoji,s=e.onEmojiClick;return Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)("div",{children:[t?Object(c.jsxs)("span",{children:["You chose: ",t.emoji]}):Object(c.jsx)("span",{children:"No emoji Chosen"}),Object(c.jsx)(j.a,{onEmojiClick:s,preload:!0,pickerStyle:{width:"450px",height:"250px"}})]})})},d=o.a.memo((function(e){var t=e.sendMessageForm,s=e.status,o=e.showEmoji,i=Object(a.useState)(""),l=Object(n.a)(i,2),j=l[0],d=l[1],b=Object(a.useState)(),m=Object(n.a)(b,2),g=m[0],O=m[1],h=Object(a.useState)(),f=Object(n.a)(h,2),x=f[0],v=f[1],p=Object(a.useState)(!1),_=Object(n.a)(p,2)[1],N=new FileReader;N.onload=function(){O(N.result)};var M=function(){if(g)_(!0);else{if(!j)return;t(j),d("")}};return Object(c.jsxs)("div",{className:r.a.addMessageContent,children:[Object(c.jsx)("textarea",{onChange:function(e){d(e.currentTarget.value)},onKeyPress:function(e){"Enter"===e.key&&(M(),d(""))},value:j,className:"".concat(r.a.textarea),children:" "}),Object(c.jsx)("button",{onClick:M,disabled:"ready"!==s,children:"Send"}),o&&Object(c.jsx)(u,{chosenEmoji:x,onEmojiClick:function(e,t){v(t),d(j+t.emoji)}})]})}))},310:function(e,t,s){e.exports={button:"Messages_button__3-LlH",recipient:"Messages_recipient__bYYMU",sender:"Messages_sender__W6npE",message:"Messages_message__1GR7A",messageBody:"Messages_messageBody__Ul-u9"}},311:function(e,t,s){e.exports={modal:"ModalInfo_modal__rgXMO",modal_active:"ModalInfo_modal_active__13Pfu",modal_content:"ModalInfo_modal_content__1wv08",modal_content_active:"ModalInfo_modal_content_active__2Yb80",buttonsQuestion:"ModalInfo_buttonsQuestion__2YHtQ"}},314:function(e,t,s){"use strict";s.r(t);var n=s(20),c=s(2),a=s(0),o=s(1),i=s.n(o),r=s(307),l=s.n(r),j=s(7),u=s(123),d=s(62),b=s(13),m=s(24),g=s(308),O=s(310),h=s.n(O),f=s(60),x=s(311),v=s.n(x),p=function(e){var t=e.title,s=e.active,n=e.setActive,c=e.onButtonModal,i=s?"".concat(v.a.modal," ").concat(v.a.modal_active):"".concat(v.a.modal),r=s?"".concat(v.a.modal_content," ").concat(v.a.modal_content_active):"".concat(v.a.modal_content),l=Object(o.useState)(!1),j=Object(m.a)(l,2)[1],u=function(e){"Enter"===e.key&&(c(),n(!1)),e.key,j(!1),n(!1)};return Object(a.jsx)("div",{className:i,onClick:function(){return n(!1)},children:Object(a.jsxs)("div",{className:r,onClick:function(e){return e.stopPropagation()},children:[Object(a.jsx)("div",{children:t}),Object(a.jsxs)("div",{className:v.a.buttonsQuestion,children:[Object(a.jsx)("input",{type:"button",value:"Yes",autoFocus:!0,onKeyPress:u,onClick:function(){c(),n(!1)},className:v.a.buttonQuestion}),Object(a.jsx)("input",{type:"button",value:"No",autoFocus:!0,onKeyDown:u,onClick:function(){j(!1),n(!1)},className:v.a.buttonQuestion})]})]})})},_=s(312),N=i.a.memo((function(e){var t=e.messageData,s=e.photos,n=e.userId,c=e.myPhoto,i=Object(j.c)(),r=Object(o.useState)(!1),l=Object(m.a)(r,2),u=l[0],b=l[1],g=n&&+n===t.recipientId?h.a.recipient:h.a.sender,O=n&&+n===t.recipientId?c:s&&s.small,x=_.DateTime.fromISO(t.addedAt);return Object(a.jsx)("div",{className:h.a.content,children:Object(a.jsxs)("div",{className:"".concat(h.a.message," ").concat(g),children:[s&&Object(a.jsx)("div",{children:Object(a.jsx)("img",{src:O,alt:"",width:50,className:"img-circle"})?Object(a.jsx)("img",{src:O,alt:"",width:50,className:"img-circle"}):Object(a.jsx)(f.a,{})}),t.deletedByRecipient?Object(a.jsxs)("span",{children:[" ","Deleted by companion"," "]}):t.deletedBySender?Object(a.jsxs)("span",{children:[" ","Deleted by you"," "]}):Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{className:"".concat(h.a.messageBody),children:[" ",t.body," "]}),Object(a.jsxs)("div",{children:[" ",x.setLocale("ru").toFormat("dd LLL yyyy HH:mm ")," "]}),Object(a.jsxs)("div",{className:h.a.bold,children:[" ",!t.viewed&&"Message not viewed"," "]}),Object(a.jsx)("div",{children:n&&+n===t.recipientId?Object(a.jsx)("button",{onClick:function(){return b(!0)},className:h.a.button,children:" del "}):Object(a.jsx)("button",{onClick:function(){return b(!0)},className:h.a.button,children:" spam "})})]}),Object(a.jsx)(p,{title:"Are you sure?",active:u,setActive:b,onButtonModal:function(){i(Object(d.g)(t.id)),i(Object(d.c)(Number(n),1,20)),i(Object(d.e)(!1))}}),Object(a.jsx)(p,{title:"Are you sure?",active:u,setActive:b,onButtonModal:function(){i(Object(d.f)(t.id)),i(Object(d.c)(Number(n),1,20)),i(Object(d.e)(!1))}})]})})})),M=s(15),w=i.a.memo((function(e){var t=e.userId,s=e.friendsAll,c=e.profile,i=e.messageData,r=Object(j.c)(),u=Object(o.useRef)(null),b=Object(j.d)((function(e){return e.dialogPage})),O=b.isLoadingMessage,h=b.isNoMessage,x=Object(o.useState)(2),v=Object(m.a)(x,2),p=v[0],_=v[1],w=Object(o.useState)(!1),y=Object(m.a)(w,2),C=y[0],I=y[1],S=Object(o.useState)(Object(n.a)(i)),k=Object(m.a)(S,2),D=k[0],P=k[1];Object(o.useEffect)((function(){P(i)}),[i]),Object(o.useEffect)((function(){h&&u.current&&(u.current.scrollTop=0)}),[h]),Object(o.useEffect)((function(){!C&&setTimeout((function(){u.current&&u.current.scrollBy({behavior:"smooth",top:u.current.scrollHeight})}),0)}),[C,i]);var E=s.filter((function(e){return String(e.id)===t}));return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{className:l.a.dialogWindow,children:[Object(a.jsxs)(M.b,{to:"/profile/"+t,children:[Object(a.jsx)("h2",{className:l.a.companionName,children:E[0].name}),E?Object(a.jsx)("img",{src:E[0].photos.small,className:"img-circle",alt:""}):Object(a.jsx)(f.a,{})]}),Object(a.jsxs)("div",{className:l.a.dialogScrollbar,onScroll:function(e){var s=e.currentTarget;!h&&i.length>0&&0===s.scrollTop&&(_(p+1),u.current&&(u.current.scrollBy({behavior:"smooth",top:u.current.scrollHeight/(p-1)}),I(!0)),r(Object(d.c)(Number(t),p,20,D)))},ref:u,children:[!h&&D.length>19&&Object(a.jsx)("div",{className:l.a.messagesHistory,children:"\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"}),h&&Object(a.jsxs)("div",{className:l.a.messagesHistory,children:[" ","\u0411\u043e\u043b\u044c\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043d\u0435\u0442"]}),c&&D&&D.map((function(e,s){return Object(a.jsx)("div",{className:l.a.messagePrivateContent,children:Object(a.jsx)(N,{messageData:e,photos:E[0].photos,userId:t,myPhoto:null===c||void 0===c?void 0:c.photos.large},s)},"message-".concat(s))})),"loading"===O&&Object(a.jsxs)("div",{className:l.a.messagesLoading,children:[" ","Is Loading"]})]})]}),Object(a.jsx)(g.a,{sendMessageForm:function(e){r(Object(d.h)(Number(t),e))},status:"ready",showEmoji:!1})]})})),y=function(e){var t=e.user,s=e.startDialog,n=e.page,c=e.count,o=e.navLink;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{children:[" ",t.userName," "]}),Object(a.jsx)(M.b,{to:o+String(t.id),children:t.photos.small?Object(a.jsx)("img",{src:t.photos.small,alt:"",width:75}):t.photos.big?Object(a.jsx)("img",{src:t.photos.big,alt:"",width:75}):Object(a.jsx)(f.a,{})})]}),Object(a.jsx)("div",{children:Object(a.jsxs)(M.b,{to:o+String(t.id),className:l.a.navLink,children:[Object(a.jsx)("button",{onClick:function(){return s(String(t.id),n,c)},children:" To write message"}),t.hasNewMessages&&Object(a.jsx)("span",{children:Object(a.jsxs)("span",{className:l.a.newMessagesCount,children:[" ",t.newMessagesCount," "]})})]})})]})},C=s(22),I=s(34);t.default=function(){Object(I.a)();var e=Object(j.c)(),t=Object(b.i)().userId,s=Object(j.d)((function(e){return e.usersPage})).followingInProgress,i=Object(j.d)((function(e){return e.dialogPage})),r=i.isStartDialog,m=i.friendsDialogs,g=i.page,O=i.count,h=i.friends,f=i.messageData,x=Object(j.d)((function(e){return e.auth.isAuth})),v=Object(j.d)((function(e){return e.auth.id})),p=Object(j.d)((function(e){return e.profilePage.profile}));Object(o.useEffect)((function(){e(Object(C.a)(String(v))),e(Object(d.d)(g,O,{term:"",friend:!0})),e(Object(d.b)())}),[e,v,g,O]);var _=function(t){e(Object(d.i)(!1)),e(Object(d.e)(!1)),e(Object(d.j)(Number(t))),e(Object(d.c)(Number(t),1,20))},N=h.reduce((function(e,t){return m.some((function(s){s.id===+t.id&&e.push(Object(c.a)(Object(c.a)({},t),{},{hasNewMessages:s.hasNewMessages,newMessagesCount:s.newMessagesCount}))})),e}),[]),M=h.filter((function(e){return N.every((function(t){return e.id!==t.id}))})),S=[].concat(Object(n.a)(M),Object(n.a)(N)),k=S.reduce((function(e,t){return void 0===t.newMessagesCount?e:e+t.newMessagesCount}),0);return S.sort((function(e,t){return t.newMessagesCount?e.newMessagesCount||(e.newMessagesCount=0):t.newMessagesCount=0,t.newMessagesCount-e.newMessagesCount})),x?Object(a.jsxs)("div",{className:"row top left gap-offset ".concat(l.a.dialogsContent),children:[Object(a.jsxs)("div",{className:l.a.dialogItems,children:[" ",Object(a.jsxs)("div",{className:l.a.messagePageInfo,children:[" ","Number of friends: "+S.length," "]}),Object(a.jsxs)("div",{className:l.a.messagePageInfo,children:[" ","New messages: "+k," "]}),Object(a.jsx)("div",{className:"col gap-offset ".concat(l.a.users),children:S.map((function(e,t){return Object(a.jsx)("div",{children:Object(a.jsx)(u.a,{user:e,followingInProgress:s,startDialog:_,page:g,count:O,navLink:"/dialogs/",hasNewMessages:e.hasNewMessages,newMessagesCount:e.newMessagesCount})},"user-".concat(t))}))}),Object(a.jsx)("div",{className:l.a.messagePageInfo,children:"Action dialogs: "}),m.filter((function(e){return e.hasNewMessages})).map((function(e,t){return Object(a.jsx)("div",{children:Object(a.jsx)(y,{user:e,startDialog:_,page:g,count:O,navLink:"/dialogs/"})},"dialog-".concat(t))}))]}),r&&t?Object(a.jsx)("div",{className:l.a.messages,children:Object(a.jsx)(w,{userId:t,friendsAll:S,profile:p,messageData:f})}):Object(a.jsx)("h2",{className:l.a.messages,children:" Select dialog "})]}):Object(a.jsx)(b.a,{to:"/login"})}}}]);
//# sourceMappingURL=4.74a16b1d.chunk.js.map